<!DOCTYPE html>
<html lang="en">
  <%- include("head.ejs", {title: `${dUser.name} (${dUser.username})`}) %>
  <body>
    <%- include("navbar.ejs") %> <%- include("styles/user-card.ejs") %>

    <style>
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px;
      }

      thead tr {
        font-size: 1.1rem;
        font-family: "Sen", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
          sans-serif;
        text-transform: uppercase;
      }

      td {
        border: none;
      }

      thead tr td {
        background: #2977f5;
        color: #eaeaef;
      }

      thead tr td:first-of-type {
        border-radius: 5px 0 0 0;
      }

      thead tr td:last-of-type {
        border-radius: 0 5px 0 0;
      }

      tbody tr:last-of-type td:first-of-type {
        border-radius: 0 0 0 5px;
      }

      tbody tr:last-of-type td:last-of-type {
        border-radius: 0 0 5px 0;
      }

      tbody tr:nth-child(odd) {
        background: #333;
      }

      td {
        padding: 15px 20px;
        text-align: center;
      }

      td {
        width: 10%;
      }
      td:nth-child(1) {
        width: 60%;
        text-align: left;
      }
    </style>

    <div class="body-container">
      <div class="flex-container">
        <div class="card">
          <div class="img">
            <img src="<%- dUser.photo %>" alt="<%- dUser.name %>" style="object-fit: cover;" />
            <div class="name"><%- dUser.name %></div>
            <div class="username">@<%- dUser.username %></div>
            <% if(dUser.exunite || dUser.admin || dUser.disqualified) { %>
            <div class="tags">
              <% if(dUser.exunite) { %>
              <span class="exunite">Exunite</span>
              <% } %> <% if(dUser.admin) { %>
              <span class="admin">Admin</span>
              <% } %> <% if(dUser.disqualified) { %>
              <span class="dq">Disqualified</span>
              <% } %>
            </div>
            <% } %>
          </div>
          <div class="info">
            <div class="half-flex">
              <div class="class">
                <svg
                  aria-hidden="true"
                  focusable="false"
                  data-prefix="fas"
                  data-icon="school"
                  class="svg-inline--fa fa-school fa-w-20"
                  role="img"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 640 512"
                >
                  <path
                    fill="currentColor"
                    d="M0 224v272c0 8.84 7.16 16 16 16h80V192H32c-17.67 0-32 14.33-32 32zm360-48h-24v-40c0-4.42-3.58-8-8-8h-16c-4.42 0-8 3.58-8 8v64c0 4.42 3.58 8 8 8h48c4.42 0 8-3.58 8-8v-16c0-4.42-3.58-8-8-8zm137.75-63.96l-160-106.67a32.02 32.02 0 0 0-35.5 0l-160 106.67A32.002 32.002 0 0 0 128 138.66V512h128V368c0-8.84 7.16-16 16-16h96c8.84 0 16 7.16 16 16v144h128V138.67c0-10.7-5.35-20.7-14.25-26.63zM320 256c-44.18 0-80-35.82-80-80s35.82-80 80-80 80 35.82 80 80-35.82 80-80 80zm288-64h-64v320h80c8.84 0 16-7.16 16-16V224c0-17.67-14.33-32-32-32z"
                  ></path>
                </svg>
                <%- dUser.class %>-<%- dUser.section %>
              </div>
              <div class="level">
                <svg
                  aria-hidden="true"
                  focusable="false"
                  data-prefix="fas"
                  data-icon="star"
                  class="svg-inline--fa fa-star fa-w-18"
                  role="img"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 576 512"
                >
                  <path
                    fill="currentColor"
                    d="M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"
                  ></path>
                </svg>
                <%- levelNo %> <% if(dUser.finished) { %>
                <span style="margin-left: 5px;">&#127937;</span>
                <% } %>
              </div>
              <div class="points">
                <svg
                  aria-hidden="true"
                  focusable="false"
                  data-prefix="fas"
                  data-icon="coins"
                  class="svg-inline--fa fa-coins fa-w-16"
                  role="img"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 512 512"
                >
                  <path
                    fill="currentColor"
                    d="M0 405.3V448c0 35.3 86 64 192 64s192-28.7 192-64v-42.7C342.7 434.4 267.2 448 192 448S41.3 434.4 0 405.3zM320 128c106 0 192-28.7 192-64S426 0 320 0 128 28.7 128 64s86 64 192 64zM0 300.4V352c0 35.3 86 64 192 64s192-28.7 192-64v-51.6c-41.3 34-116.9 51.6-192 51.6S41.3 334.4 0 300.4zm416 11c57.3-11.1 96-31.7 96-55.4v-42.7c-23.2 16.4-57.3 27.6-96 34.5v63.6zM192 160C86 160 0 195.8 0 240s86 80 192 80 192-35.8 192-80-86-80-192-80zm219.3 56.3c60-10.8 100.7-32 100.7-56.3v-42.7c-35.5 25.1-96.5 38.6-160.7 41.8 29.5 14.3 51.2 33.5 60 57.2z"
                  ></path>
                </svg>
                <%- dUser.points %>
              </div>
            </div>

						<div class="last">
							<% if(lastMoveTime) { %>
                Last attempt <%- lastMoveTime %>
							<% } else { %>
							  No attempts yet
							<% } %>
            </div>

            <% if(user.exunite || user.admin) { %>
            <div class="email" style="text-align: center;">
              <%- dUser.email %>
            </div>
            <div class="phone" style="text-align: center;">
              <%- dUser.phone %>
            </div>
            <% } %> <% if(user.admin) { %>
            <div class="buttons">
              <form action="" method="post" style="display: none;" id="submit">
                <input
                  type="hidden"
                  name="username"
                  value="<%- dUser.username %>"
                />
                <input type="hidden" name="_csrf" value="<%- csrfToken %>" />
              </form>
              <div class="full">
                <% if(dUser.disqualified) { %>
                <a class="dq" href="/users/dq">Requalify</a>
                <% } else { %>
                <a class="dq" href="/users/dq">Disqualify</a>
                <% } %>
              </div>

              <div class="half">
                <% if(dUser.exunite) { %>
                <a class="exunite" href="/users/exunite">Non-Exunite</a>
                <% } else { %>
                <a class="exunite" href="/users/exunite">Exunite</a>
                <% } %> <% if(dUser.admin) { %>
                <a class="admin" href="/users/admin">Demote</a>
                <% } else { %>
                <a class="admin" href="/users/admin">Admin</a>
                <% } %>
              </div>
            </div>
            <% } %>
          </div>
        </div>
      </div>

      <% if(user.admin) { %>
      <h1 style="text-align: center; margin-top: 50px;">Attempts</h1>
      <table>
        <thead>
          <tr>
            <td>Level</td>
            <td>Attempt</td>
            <td>Answer</td>
            <td>Timestamp</td>
          </tr>
        </thead>
        <tbody>
          <% for(let attempt of attempts) { %>
          <tr>
            <td><%- attempt.level %></td>
            <td><%- attempt.attempt %></td>
            <td><%- attempt.correct %></td>
            <td>
              <div><%- attempt.date %></div>
              <div><%- attempt.time %></div>
            </td>
          </tr>
          <% } %>
        </tbody>
      </table>
      <% } %>
    </div>

    <%- include("footer.ejs") %>

    <script>
      const form = document.querySelector("form#submit");

      document.querySelectorAll(".buttons a").forEach(e_ =>
        e_.addEventListener("click", e => {
          e.preventDefault();
          form.setAttribute("action", e.target.href);
          form.submit();
        })
      );
    </script>
  </body>
</html>
